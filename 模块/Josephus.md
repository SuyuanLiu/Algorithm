# 约瑟夫环 Josephus Problem

本文从约瑟夫环的基本问题说起，拓展到一些变形问题。(我在网上看了很多解释，感觉讲的不是很清楚！会让人一头雾水！我来给重新解释！😈)

**Index**
- [基本问题](#基本问题)
- [约瑟夫变形](#约瑟夫变形)

## 基本问题

> 约瑟夫环问题是：n个人（编号为1，2，3...n）围成一圈坐在一起，从编号k的人开始报数，数到m的人出局。下一个人从1开始报数，数到m的人又出局。依次下去，问最后剩下那个人的编号。

有两种方法：
- 建立一个链表，然后依次依据条件删掉对应元素即可。时间复杂度是O(mn),还要耗费额外的空间（详细代码可以参考[这里](https://blog.csdn.net/wuzhekai1985/article/details/6628491)）。
- 动态规划，用递推关系来找到最后的胜利者。时间复杂度O(n),空间复杂度O(1).（本文只介绍这个方法）

这个问题先正着思考：从n个人变为n-1个人，编号如何映射；再倒着求解：最后一轮只剩一个人的编号，倒着推n个人时胜利者的编号。

**动态规划思路**  
每次出局一个人作为一轮，每轮之后对剩下的人，从出局者后一个从0重新编号。对重新编号的号做 `+m` 的操作，可以映射到上一轮对应的编号。那么从最后一轮，只剩一个人（胜利者）的编号做 `+m` 的操作，映射到胜利者在倒数第二轮的编号，再 `+m` 映射到上一轮，依次递推下去，就可以找到胜利者对应的初始编号。

`用f[i]表示当剩i个人时，胜利者在这i个人中的新的编号`

比如：一开始有n个人，第一轮出局第m个人，下标对应为 m-1，对剩下的人 m， m+1，...重新编号(👇表格)。

|上一轮编号|新一轮编号| 
|--------|--------|
|m|0|
|m+1|1|
|m+2|2|
|...|...|
|n-1|n-m-1|
|0|n-m|
|1|n-m+1|
|...|...|

可以发现新一轮编号要映射到上一轮编号，只要 `+m` 就行了。（注意：新一轮编号+m之后，可能超过n，所以要对n取余，即：要再对**上一轮人数**取余，得到上一轮编号）也就得到递推公式：`f[i] = (f[i-1] + m) % i` 

现在要倒着递推，先找到这个胜利者。当最后只剩一个人，那么这个人就是胜利者，他此时的新编号就是0，也就是说 f[1] = 0, 由此可以推出 f[2] = (f[1]+m)%2, 再推出f[3]...,一直到 f[n]。注意此时得到的 f[n]，编号是从0开始的，而题目要求是从1开始的，只要在最后结果是加1即可。

对应python代码如下(暂未验证)：
``` python
def Josephus(n, m):
    '''
    n: the number of people
    m: people who is the mth is out
    return: number of winner
    '''
    if n < 2:
        return 1
    res = 0
    for i in range(2, n):
        res = (res + m) % i 
    return res + 1
```

## 约瑟夫变形

> 第一轮出局的人的编号必须为k，之后再让出局后的人报数，报到m出局，问最后胜利者编号。

「引自[这里](https://www.zhihu.com/question/20065611)」要求编号从1开始，只要把f[n]+1即可，同时，指定了第一个要删除的人必须为编号为k的人，其实也不难，求出f[n]之后，把原本编号为0的位置移到跟k只相距m的位置即可实现第一次删除的编号为k。所以最终 ans=(f[n]+1+k-m);当然因为k-m可能为负数，导致整个res为负，这样其实最后+n即可解决.

``` python
def Josephus(n, m, k):
    '''
    n: the number of person
    m: people who is the mth is out
    k: number of the first out person
    return: number of winner
    '''
    if n < 2:
        return 1
    res = 0
    for i in range(2, n):
        res = (res + m) % i 
    res = (res + 1 + k - m)
    if res < 0:
        return res + n
    return res 
```


> http://blog.sina.com.cn/s/blog_882fba2b01016plc.html


> 鹅🐧厂笔试题：扑克牌那题，其实就是约瑟夫环啊。


## 参考

- https://www.zhihu.com/question/20065611